# Repository Guidelines

## Project Structure & Module Organization

- `app/` Expo Router screens and layouts (for example `app/(tabs)/rallye/index.tsx`).
- `components/` UI primitives and feature components (`components/ui`, `components/themed`, `components/rallye`).
- `services/` storage, offline outbox, and Supabase access.
- `utils/` shared helpers, contexts, and styling; `types/` shared TypeScript types.
- `assets/` images and fonts; `docs/` planning docs; `android/` and `ios/` are generated by `expo prebuild`.

## Build, Test, and Development Commands

- `npm run start`: start Expo Go with cache clear.
- `npm run android` / `npm run ios`: run dev builds on device or simulator.
- `npm run web`: run the web target.
- `npm test`: execute test suite
- `npm run lint`: run ESLint via Expo.
- `npx tsc --noEmit`: compile TypeScript files

## Working on features

Work in small, meaningful, atomic steps. Each step must address exactly one concern (no mixed commits, no “incidental” refactors/formatting without purpose).

For each step:

1. List the files changed.
2. Propose a clear, compact commit message (imperative mood, precisely describing the change).
3. Provide a brief summary: what/why.
4. Tests: Evaluate whether unit/component/e2e tests are needed.
   - If behavior changes / bugfix: implement tests in the same step (ideally write the test first, then the fix).
   - If it’s a pure refactor: no new tests required, but all existing tests must pass.
   - If test setup is needed: do a separate setup-only step first, then a following step for tests + code.
5. After each step, run `npm run lint`, `npx tsc --noEmit` and `npm test`.

Hard rule: If `npm run lint`, `npx tsc --noEmit` or `npm test` FAIL, do not commit and do not proceed to the next step until they pass.

IMPORTANT: Stop after each step and wait for my “OK” before committing or moving on to the next step. Make any assumptions/uncertainties explicit and ask me to clarify when needed.

## Coding Style & Naming Conventions

- TypeScript, strict mode enabled; 2-space indentation.
- Components: PascalCase `*.tsx` (e.g., `ThemedText.tsx`). Hooks: `useX.ts`.
- Constants: PascalCase files; exported constants in UPPER_SNAKE_CASE where appropriate.
- Path alias `@/*` is available (see `tsconfig.json`).
- Code comments always in English

## Testing Guidelines

Testing is supported with Jest (via `jest-expo`) and `@testing-library/react-native`.
- Place tests alongside source (`*.test.ts` / `*.test.tsx`) or in `__tests__/`.
- Prefer user-facing tests with Testing Library and avoid implementation details.
- Use `npm test` for single runs and `npm run test:watch` for watch mode.
- Mock native or Expo modules and side effects to keep tests deterministic.
- For UI or behavior changes, add or update tests when feasible and document manual coverage gaps.

## Commit & Pull Request Guidelines

- Commits are typically short, imperative summaries in English and often reference issues (e.g., `Fix #17`). Keep the subject concise (≈72 chars) and include `#<issue>` when relevant.
- PRs should explain what/why, include screenshots for UI changes.

## Configuration & Secrets

Create a local `.env` with `EXPO_PUBLIC_SUPABASE_URL` and `EXPO_PUBLIC_SUPABASE_ANON_KEY` (see `README.md`). Do not commit secrets; use Supabase project settings to retrieve keys.
